# vdc-node-red
The base image for the IDEKO VDC which is built with Node-RED and it includes:

 - The Throughput Agent
 - Node-RED

The _Dockerfile_ downloads the Throughput Agent from the [official repository](https://github.com/DITAS-Project/VDC-Throughput-Agent) and compiles it. Then copies the statically linked executable to a `node-red:slim` (alpine) image.

It runs the Throughput Agent as _root_, then installs the neccesary flows to install the IDEKO VDC, copies the `flows.json` and `settings.json` files to Node-RED `/data` directory and installs `R`. Finally, runs Node-red as _node-red_ user.

Requirements
===

To run properly, some requirements must be met:

* Mount `/opt/blueprint` with the Throughput Agent config file: `traffic.json`. This passes the container the config file for the Throughput Agent.
* Launch previously the Elasticsearch container that will save the data generated by the Throughput Agent.

How to run the container
===
Build using `docker build -t computation-vdc .` from the folder where the Dockerfile is.


This info is for the Deployment Engine. NOTE: adapt the host paths

```
docker run -d -p 1888:1888 -v /HOST/CONFIG/FOLDERfig:/etc/config ditas/vdc-node-red:production
```

Part by part:

* `1888:1888` to map the Node-RED ports.
* `-v /HOST/CONFIG/FOLDER:/etc/config` to provide the `traffic.json` with the Throughput Agent config. And perhaps the whole blueprint.
